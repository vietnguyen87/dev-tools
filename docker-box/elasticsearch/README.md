##Guide 
Copy folder config to docker 

## Create Setting & Mapping 
https://sendovn.atlassian.net/wiki/spaces/RD2/pages/2662006898/Build+Sendo+ES+on+localhost

curl --location --request PUT 'localhost:9200/product_v4' \
--header 'Content-Type: application/json' \
--data-raw '{
   "settings":{
      "index":{
         "max_ngram_diff":"13",
         "mapping":{
            "total_fields":{
               "limit":"2000"
            }
         },
         "refresh_interval":"20s",
         "indexing":{
            "slowlog":{
               "level":"debug",
               "threshold":{
                  "index":{
                     "warn":"2s",
                     "trace":"500ms",
                     "debug":"800ms",
                     "info":"1s"
                  }
               },
               "source":""
            }
         },
         "requests":{
            "cache":{
               "enable":"true"
            }
         },
         "analysis":{
            "filter":{
               "synonym_with_standardized_accent_marks_filter":{
                  "type":"synonym",
                  "synonyms_path":"analysis/synonyms_standardizer.txt",
                  "synonyms":[
                     
                  ]
               },
               "translation":{
                  "type":"nGram",
                  "min_gram":"2",
                  "max_gram":"15"
               },
               "synonym_index_filter":{
                  "type":"synonym",
                  "synonyms_path":"analysis/synonyms_normal.txt",
                  "synonyms":[
                     
                  ]
               },
               "synonym_query_filter":{
                  "type":"synonym",
                  "synonyms_path":"analysis/synonyms_no_accents.txt",
                  "synonyms":[
                     
                  ]
               },
               "synonym_with_standardized_accent_marks_filter_updateable":{
                  "type":"synonym",
                  "synonyms_path":"analysis/synonyms_standardizer.txt",
                  "synonyms":[
                     
                  ],
                  "updateable":true
               },
               "synonym_index_filter_updateable":{
                  "type":"synonym",
                  "synonyms_path":"analysis/synonyms_normal.txt",
                  "synonyms":[
                     
                  ],
                  "updateable":true
               },
               "synonym_query_filter_updateable":{
                  "type":"synonym",
                  "synonyms_path":"analysis/synonyms_no_accents.txt",
                  "synonyms":[
                     
                  ],
                  "updateable":true
               }
            },
            "char_filter":{
               "accent_marks_standardizer":{
                  "type":"mapping",
                  "mappings_path":"analysis/char_filter_accent_marks_standardizer.txt"
               }
            },
            "analyzer":{
               "translation_index_analyzer":{
                  "filter":"lowercase,translation,asciifolding,trim,unique",
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_with_accent_marks_analyzer_v2":{
                  "filter":"lowercase,trim,unique",
                  "char_filter":[
                     "accent_marks_standardizer"
                  ],
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_with_accent_marks_normalized_analyzer_v2":{
                  "filter":"lowercase,trim,unique",
                  "char_filter":[
                     "icu_normalizer",
                     "accent_marks_standardizer"
                  ],
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_search_analyzer":{
                  "filter":"lowercase,asciifolding,trim,unique",
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_index_analyzer_v2":{
                  "filter":"lowercase,asciifolding,trim,unique",
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_index_normalized_analyzer_v2":{
                  "filter":"lowercase,asciifolding,trim,unique",
                  "char_filter":[
                     "icu_normalizer"
                  ],
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_search_analyzer_v2":{
                  "filter":"lowercase,asciifolding,trim,unique",
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_search_normalized_analyzer_v2":{
                  "filter":"lowercase,asciifolding,trim,unique",
                  "char_filter":[
                     "icu_normalizer"
                  ],
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_synonym_index_analyzer":{
                  "filter":"lowercase,trim,synonym_index_filter,asciifolding,unique",
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_synonym_index_analyzer_v2":{
                  "filter":"lowercase,trim,synonym_with_standardized_accent_marks_filter,asciifolding,unique",
                  "char_filter":[
                     "accent_marks_standardizer"
                  ],
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_unicode_normalized_analyzer_v2":{
                  "filter":"lowercase,trim,unique",
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_synonym_search_analyzer":{
                  "filter":"lowercase,asciifolding,trim,synonym_query_filter,unique",
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "slash_analyzer":{
                  "filter":"lowercase,trim,unique",
                  "type":"custom",
                  "tokenizer":"slash_tokenizer"
               },
               "translation_with_accent_marks_synonyms_analyzer":{
                  "filter":"lowercase,trim,synonym_with_standardized_accent_marks_filter,unique",
                  "char_filter":[
                     "accent_marks_standardizer"
                  ],
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_with_accent_marks_synonyms_normalized_analyzer":{
                  "filter":"lowercase,trim,synonym_with_standardized_accent_marks_filter,unique",
                  "char_filter":[
                     "icu_normalizer",
                     "accent_marks_standardizer"
                  ],
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_with_accent_marks_synonyms_normalized_search_analyzer":{
                  "filter":"lowercase,trim,synonym_with_standardized_accent_marks_filter_updateable,unique",
                  "char_filter":[
                     "icu_normalizer",
                     "accent_marks_standardizer"
                  ],
                  "type":"custom",
                  "tokenizer":"keyword"
               },
               "semicolon_token_analyzer":{
                  "lowercase":"true",
                  "pattern":";",
                  "type":"pattern"
               },
               "translation_with_accent_marks_index_analyzer":{
                  "filter":"lowercase,trim,unique",
                  "type":"custom",
                  "tokenizer":"standard"
               },
               "translation_with_accent_marks_search_analyzer":{
                  "filter":"lowercase,trim,unique",
                  "type":"custom",
                  "tokenizer":"standard"
               }
            },
            "tokenizer":{
               "slash_tokenizer":{
                  "pattern":"/",
                  "type":"simple_pattern_split"
               }
            }
         },
         "number_of_replicas":"1",
         "search":{
            "slowlog":{
               "level":"info",
               "threshold":{
                  "fetch":{
                     "warn":"1s",
                     "trace":"200ms",
                     "debug":"500ms",
                     "info":"800ms"
                  },
                  "query":{
                     "warn":"1s",
                     "trace":"200ms",
                     "debug":"500ms",
                     "info":"800ms"
                  }
               }
            }
         },
         "number_of_shards":"7",
         "similarity":{
            "bm25_b_0":{
               "type":"BM25",
               "b":"0.0"
            }
         }
      }
   },
   "mappings":{
      "dynamic":"false",
      "properties":{
         "_updated_at":{
            "type":"date"
         },
         "admin_id":{
            "type":"long"
         },
         "app_discount_percentage":{
            "type":"byte"
         },
         "assignee":{
            "type":"text",
            "fields":{
               "keyword":{
                  "type":"keyword",
                  "ignore_above":256
               }
            }
         },
         "brand_id":{
            "type":"long"
         },
         "cabinet_list":{
            "type":"integer"
         },
         "category_ids":{
            "type":"integer"
         },
         "category_name_suggest":{
            "type":"text",
            "store":true,
            "term_vector":"with_positions_offsets",
            "fields":{
               "synonyms":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_synonym_index_analyzer",
                  "search_analyzer":"translation_synonym_search_analyzer"
               },
               "synonyms_v2":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_synonym_index_analyzer_v2",
                  "search_analyzer":"translation_synonym_search_analyzer"
               },
               "unicode_normalized":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_unicode_normalized_analyzer_v2"
               },
               "with_accent_marks":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_with_accent_marks_index_analyzer",
                  "search_analyzer":"translation_with_accent_marks_search_analyzer"
               },
               "with_accent_marks_synonyms":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_with_accent_marks_synonyms_analyzer"
               },
               "with_accent_marks_v2":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_with_accent_marks_analyzer_v2"
               },
               "name_bm25b0_normalized":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_index_normalized_analyzer_v2",
                  "search_analyzer":"translation_search_normalized_analyzer_v2"
               },
               "with_accent_marks_synonyms_normalized_bm25b0":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_with_accent_marks_synonyms_normalized_analyzer",
                  "search_analyzer":"translation_with_accent_marks_synonyms_normalized_search_analyzer"
               },
               "with_accent_marks_v2_normalized_bm25b0":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_with_accent_marks_normalized_analyzer_v2"
               }
            },
            "analyzer":"translation_index_analyzer_v2",
            "search_analyzer":"translation_search_analyzer_v2"
         },
         "category_path":{
            "type":"text",
            "eager_global_ordinals":true,
            "analyzer":"slash_analyzer"
         },
         "collection_ids":{
            "type":"keyword"
         },
         "created_at":{
            "type":"date"
         },
         "default_listing_scores":{
            "properties":{
               "brand_boost":{
                  "type":"half_float"
               },
               "description_score_boost":{
                  "type":"half_float"
               },
               "discount_app_boost":{
                  "type":"half_float"
               },
               "discount_boost":{
                  "type":"half_float"
               },
               "is_updated":{
                  "type":"boolean"
               },
               "order_completed_15_boost_cate_2":{
                  "type":"half_float"
               },
               "order_completed_15_boost_cate_3":{
                  "type":"half_float"
               },
               "order_completion_rate_boost":{
                  "type":"half_float"
               },
               "rating_boost":{
                  "type":"half_float"
               },
               "score_cate_2":{
                  "type":"half_float"
               },
               "score_cate_3":{
                  "type":"half_float"
               },
               "shipping_fee_boost":{
                  "type":"half_float"
               },
               "shop_hoa_sen_boost":{
                  "type":"half_float"
               },
               "shop_mall_boost":{
                  "type":"half_float"
               },
               "shop_tich_cuc_boost":{
                  "type":"half_float"
               },
               "subsidized_shipping_fee_boost":{
                  "type":"half_float"
               },
               "updated_at":{
                  "type":"date"
               }
            }
         },
         "extended_shipping_package":{
            "properties":{
               "is_self_shipping":{
                  "type":"boolean"
               },
               "is_using_eco":{
                  "type":"boolean"
               },
               "is_using_in_day":{
                  "type":"boolean"
               },
               "is_using_instant":{
                  "type":"boolean"
               },
               "is_using_standard":{
                  "type":"boolean"
               }
            }
         },
         "external_id":{
            "type":"long"
         },
         "filter_type":{
            "type":"byte"
         },
         "has_certificate":{
            "type":"boolean"
         },
         "has_variant":{
            "type":"boolean"
         },
         "is_certificate_shop":{
            "type":"boolean"
         },
         "is_event":{
            "type":"boolean"
         },
         "is_installment":{
            "type":"boolean"
         },
         "is_loyalty":{
            "type":"boolean"
         },
         "is_off":{
            "type":"boolean"
         },
         "is_review":{
            "type":"boolean"
         },
         "is_review_type":{
            "type":"long"
         },
         "is_shop_plus":{
            "type":"boolean"
         },
         "is_shop_support_shipping_fee":{
            "type":"boolean"
         },
         "is_stock":{
            "type":"boolean"
         },
         "is_updated_at":{
            "type":"boolean"
         },
         "like_counter":{
            "type":"long"
         },
         "listing_score":{
            "properties":{
               "score_v2":{
                  "type":"long"
               },
               "score_v3":{
                  "type":"long"
               },
               "updated_at_v2":{
                  "type":"date"
               },
               "updated_at_v3":{
                  "type":"date"
               }
            }
         },
         "min_shop_support_shipping_fee":{
            "type":"long"
         },
         "name":{
            "type":"text",
            "store":true,
            "term_vector":"with_positions_offsets",
            "fields":{
               "name_bm25b0":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_index_analyzer_v2",
                  "search_analyzer":"translation_search_analyzer_v2"
               },
               "name_bm25b0_normalized":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_index_normalized_analyzer_v2",
                  "search_analyzer":"translation_search_normalized_analyzer_v2"
               },
               "with_accent_marks_synonyms_bm25b0":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_with_accent_marks_synonyms_analyzer"
               },
               "with_accent_marks_synonyms_normalized_bm25b0":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_with_accent_marks_synonyms_normalized_analyzer",
                  "search_analyzer":"translation_with_accent_marks_synonyms_normalized_search_analyzer"
               },
               "with_accent_marks_v2_bm25b0":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_with_accent_marks_analyzer_v2"
               },
               "with_accent_marks_v2_normalized_bm25b0":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_with_accent_marks_normalized_analyzer_v2"
               }
            },
            "analyzer":"translation_index_analyzer_v2",
            "search_analyzer":"translation_search_analyzer_v2"
         },
         "number_facets":{
            "type":"nested",
            "properties":{
               "name":{
                  "type":"keyword"
               },
               "value":{
                  "type":"double"
               }
            }
         },
         "number_sort":{
            "properties":{
               "final_gross_price":{
                  "type":"long"
               }
            }
         },
         "order_count":{
            "properties":{
               "dd_10":{
                  "type":"long"
               },
               "dd_1000":{
                  "type":"long"
               },
               "dd_1000_cod":{
                  "type":"long"
               },
               "dd_10_cod":{
                  "type":"long"
               },
               "dd_15":{
                  "type":"long"
               },
               "dd_15_cod":{
                  "type":"long"
               },
               "dd_30":{
                  "type":"long"
               },
               "dd_30_cod":{
                  "type":"long"
               },
               "dd_7":{
                  "type":"long"
               },
               "dd_7_cod":{
                  "type":"long"
               },
               "rank":{
                  "type":"float"
               }
            }
         },
         "product_id":{
            "type":"long"
         },
         "product_type":{
            "type":"integer"
         },
         "promotions":{
            "type":"nested",
            "properties":{
               "fixed_price":{
                  "type":"long"
               },
               "from":{
                  "type":"date"
               },
               "id":{
                  "type":"integer"
               },
               "to":{
                  "type":"date"
               },
               "type":{
                  "type":"short"
               }
            }
         },
         "quantity":{
            "type":"integer"
         },
         "rank_search":{
            "type":"double"
         },
         "rank_updated_at":{
            "type":"date"
         },
         "rating_percentage":{
            "type":"float"
         },
         "review_at":{
            "type":"date"
         },
         "review_type":{
            "type":"byte"
         },
         "search_score":{
            "properties":{
               "quality_score_v1":{
                  "type":"half_float"
               },
               "quality_score_v2":{
                  "type":"long"
               },
               "updated_at":{
                  "type":"date"
               }
            }
         },
         "seller_admin_id":{
            "type":"long"
         },
         "shop_ads":{
            "type":"boolean"
         },
         "shop_ads_plus":{
            "type":"boolean"
         },
         "shop_status_id":{
            "type":"byte"
         },
         "shop_type":{
            "type":"byte"
         },
         "sku_defined_by_shop":{
            "type":"text",
            "store":true,
            "term_vector":"with_positions_offsets",
            "fields":{
               "synonyms":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_synonym_index_analyzer",
                  "search_analyzer":"translation_synonym_search_analyzer"
               },
               "synonyms_v2":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_synonym_index_analyzer_v2",
                  "search_analyzer":"translation_synonym_search_analyzer"
               },
               "unicode_normalized":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_unicode_normalized_analyzer_v2"
               },
               "with_accent_marks":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_with_accent_marks_index_analyzer",
                  "search_analyzer":"translation_with_accent_marks_search_analyzer"
               },
               "with_accent_marks_synonyms":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_with_accent_marks_synonyms_analyzer"
               },
               "with_accent_marks_v2":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "analyzer":"translation_with_accent_marks_analyzer_v2"
               },
               "name_bm25b0_normalized":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_index_normalized_analyzer_v2",
                  "search_analyzer":"translation_search_normalized_analyzer_v2"
               },
               "with_accent_marks_synonyms_normalized_bm25b0":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_with_accent_marks_synonyms_normalized_analyzer",
                  "search_analyzer":"translation_with_accent_marks_synonyms_normalized_search_analyzer"
               },
               "with_accent_marks_v2_normalized_bm25b0":{
                  "type":"text",
                  "store":true,
                  "term_vector":"with_positions_offsets",
                  "similarity":"bm25_b_0",
                  "analyzer":"translation_with_accent_marks_normalized_analyzer_v2"
               }
            },
            "analyzer":"translation_index_analyzer_v2",
            "search_analyzer":"translation_search_analyzer_v2"
         },
         "status_id":{
            "type":"byte"
         },
         "temporary_flags":{
            "type":"nested",
            "properties":{
               "from":{
                  "type":"date"
               },
               "name":{
                  "type":"keyword"
               },
               "to":{
                  "type":"date"
               },
               "value":{
                  "type":"keyword"
               }
            }
         },
         "total_rated":{
            "type":"integer"
         },
         "updated_at":{
            "type":"date"
         },
         "vas":{
            "properties":{
               "search_upped_at":{
                  "type":"date"
               },
               "upped_at":{
                  "type":"date"
               }
            }
         },
         "video_info":{
            "properties":{
               "external_video":{
                  "type":"long"
               },
               "internal_video":{
                  "type":"long"
               }
            }
         },
         "warehouse_location_ids":{
            "type":"integer"
         }
      }
   }
}'

### relocate shards 
curl --location --request PUT 'localhost:9200/_cluster/settings' \
--header 'Content-Type: application/json' \
--data-raw '{
  "transient": {
    "cluster.routing.allocation.disk.watermark.low": "2gb", 
    "cluster.routing.allocation.disk.watermark.high": "1gb",
    "cluster.routing.allocation.disk.watermark.flood_stage": "500mb",
    "cluster.info.update.interval": "1m"
  }
}'

### Making index alias 
curl --location --request PUT 'localhost:9200/product_v4/_alias/product_alias'

### Update & Reindex 

1. Close Index 
Method: POST
localhost:9200/product_v4/_close

2. Update Settings OR Mapping Or both 
https://sendovn.atlassian.net/wiki/spaces/IAS/pages/2665545874/Change+setting+li+n+quan+t+i+unicode+ng+i+d+ng

3. Open Index 
Method: POST
localhost:9200/product_v4/_open
